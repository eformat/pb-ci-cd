destination: &ci_cd_ns labs-ci-cd

##############
# üêô Argo Sync Policy
#############
sync_policy_true: &sync_policy_true
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
    - Validate=true

sync_policy_no_selfheal: &sync_policy_no_selfheal
  syncPolicy:
    automated:
      prune: true
      selfHeal: false
    syncOptions:
    - Validate=true

##############
# üõé Argo App of Apps declaration
#############
# enabled true on an app is to tell helm to create an argo app cr for this item
# Custom values override the default values in Helm Charts
applications:
  # Nexus
  - name: nexus
    enabled: true
    source: https://redhat-cop.github.io/helm-charts
    chart_name: sonatype-nexus
    source_path: ""
    source_ref: "0.0.15"
    sync_policy: *sync_policy_true
    destination: *ci_cd_ns
    ignore_differences:
      - group: route.openshift.io
        kind: Route
        jsonPointers:
          - /status/ingress
  # Jenkins
  - name: jenkins
    enabled: true
    source: https://github.com/redhat-cop/helm-charts.git
    source_path: charts/jenkins
    source_ref: "jenkins-1.0.1"
    sync_policy: *sync_policy_true
    destination: *ci_cd_ns
    values:
      buildconfigs:
        # Jenkins S2I from Red Hat Labs
        - name: jenkins
          strategy_type: "Source"
          source_repo: https://github.com/rht-labs/s2i-config-jenkins.git
          source_repo_ref: master
          source_context_dir: '/'
          builder_image_kind: "DockerImage"
          builder_image_name: quay.io/openshift/origin-jenkins
          builder_image_tag: "latest"
        # Jenkins agents for running builds etc
        # default names, versions, repo and paths set on the template
        - name: jenkins-agent-npm
        - name: jenkins-agent-graalvm
        - name: jenkins-agent-helm
        - name: jenkins-agent-argocd
        - name: jenkins-agent-zap
      deployment:
        env_vars:
          - name: JVM_ARCH
            value: 'x86_64'
          - name: DISABLE_ADMINISTRATIVE_MONITORS
            value: 'false'
          - name: ENABLE_FATAL_ERROR_LOG_FILE
            value: 'false'
          - name: JENKINS_OPTS
            value: '--sessionTimeout=180'
          - name: GITHUB_ACCOUNT
            value: 'petbattle'
          - name: GITHUB_ORG
            value: 'true'
      persistence: false
      source_secrets:
        - name: nexus-password
          username: admin
          password: admin123
      sealed_secrets:
        - name: super-dooper
          username: AgA49U/QWVvbVlS1Ectj/up4sL4C+ArohwrnMUEDxD3xV189NtUMYLc3sJGrVid6Vfnj5YD9PUVZOwoLa5Hk+6wQjcC7wzoOLpw4v5bZh54aba0Df6m5v4oXydY8v4nxN5qJuzkP5ItVb26TgLDerQa7CWsi1n13labdXFCiA8BVD1Gk6nBsl4bSeFP49EOZ4h+WE0bhYPv6zF93DfbXkdrkvJVwBJjmItvakGTBsssyqigMc2lhvUwDpPn2g08qKzuVI3AYJQcpUjAbI7K2Lm/NBE6+thF0izBGLA/Dcwof7yBRTjzZwKF9c36goSA69W61mFtbQ4wg2w/wJPWqncfhpw4LuexwKL1ReJXEiqjhHXp8Cl/0CLPpVXDOXIc8S2slRTSpbQKFZozYnxZcyUn3x8Cp9gfZnPII3V2Ed0okpzs2Sc96EuZBK9dG5hsybeAHnCsVIUFGQliHucGqvJ7P+ftAYsLx/HV8DrK+Qw7hGUAl00RDMLwszfvoRKmB2ixuBwC/W7ZVEMN6m/sRTEUK4plm/vFnxCgElO6D0MXNObOepQCCdfSA+EavT7Lr9C8wSywPpVAXX/GryoPpLpPmph2XKXFOqke3jJLIPgfpt4jfDJAfNI1Gu/xVlsCHUNd9+xb1T+ZbwPf+A1u+baFxa0J6SwtamwWFQ1nQygnjp7f1uB8AnaLqsNhM1X6ZohK5uj3D5Q==
          password: AgDlIk7mouElHZtmfpQKxl/lMlMFALaxCoPcl/t9Z7mPJRSkoBlCS7mV1VfhRcqRwbVgDjK0AdIDFAMIs/IOtn2mhHQUgqfIXWcMO5GAQgcsJg/AZD7nrUST3pdk1N5U7xLc3rIrvfdBy5+IQTNVMLz3OUaEjMb1eSUixKBWW7jGJn3kVIMimFECWiceQznrlmJlhDwvKjLg3nMd/A3I9e7hkYg8IfyxL1D5gsnnVBg0ew6fVhhPeA8YrsWICFBLY4X3ZtkfGIeOz620UGCkRgj9u7I63M/mlRzjgJQi0CiHGol23O8anX1MK4JEK9xNUBlfPfFHiSjNb0ySmJY46CBtg2Q1qDQDw1XyBi0CTxDJDoaCqBAnIZp4TYzIYYXj2iEFDG2/+muvdR600cf34fy6ZG68ZE4gEw6jYJr7qOeoTVoDsfYImTIrRDuVskyl15TEblRzYz44CnWBymRrUNgibZ4qv8Rgc9tBXGOJYzeJiqTJJCAXHmpCuuNEvRoI04ss79KH7qhXIWFVjKhCf+5cktk9y6gdZ0TjLvap9UHd30bPshdROSihDetZvn0aldd+1X6tJYb+6Re4R2sSOErF46V+jC5qMMlLoTYSq/tf6R/gWEs3HQrvNfhv4gxpvqAUTg2QmdoPPyrBAmeCgfgeipQw8PH2ZU2UTshbEmK9BThUW7VlDqQfd9EpdOq88k6dr4oLRhoHOBEMTQ==
    ignore_differences:
      - group: apps.openshift.io
        kind: DeploymentConfig
        jsonPointers:
          - /spec/template/spec/containers/0/image
          - /spec/triggers/0/imageChangeParams/lastTriggeredImage
      - group: build.openshift.io
        kind: BuildConfig
        jsonPointers:
          - /spec/triggers
  # Pact-broker
  - name: pact-broker
    enabled: false
    source: https://github.com/redhat-cop/helm-charts.git
    source_path: charts/pact-broker
    source_ref: "pact-broker-0.0.7"
    sync_policy: *sync_policy_true
    destination: *ci_cd_ns
    values:
      secrets:
        name: pact-broker-secrets
        keys:
          pactBrokerDatabaseUsername: pact_broker_database_username
          pactBrokerDatabasePassword: pact_broker_database_password
          pactBrokerAdmin: pact_broker_admin
          pactBrokerAdminPassword: pact_broker_admin_password
          pactBrokerBasicAuthUsername: pact_broker_user
          pactBrokerBasicAuthPassword: pact_broker_user_password
        values:
          pactBrokerDatabaseUsername: pact_broker_user
          pactBrokerDatabasePassword: thisisdefinitelynotmypassword
          pactBrokerAdmin: admin
          pactBrokerAdminPassword: thisisdefinitelynotmypassword
          pactBrokerBasicAuthUsername: dev
          pactBrokerBasicAuthPassword: thisisdefinitelynotmypassword
  # Sonarqube
  - name: sonarqube
    enabled: false
    source: https://github.com/redhat-cop/helm-charts.git
    source_path: "charts/sonarqube"
    source_ref: "sonarqube-0.0.15"
    sync_policy: *sync_policy_true
    destination: *ci_cd_ns
    values:
      account:
        adminPassword: admin123
        currentAdminPassword: admin
      initContainers: true
      plugins:
        install:
          - https://github.com/checkstyle/sonar-checkstyle/releases/download/8.35/checkstyle-sonar-plugin-8.38.jar
          - https://github.com/dependency-check/dependency-check-sonar-plugin/releases/download/2.0.7/sonar-dependency-check-plugin-2.0.7.jar
  # Sonarqube setup
  - name: sonarqube-setup
    enabled: false
    source: https://github.com/eformat/sonarqube-jobs
    source_path: charts/quality-gate
    sync_policy: *sync_policy_true
    destination: *ci_cd_ns
    source_ref: main
    values:
      qualityGate:
        new_coverage:
          enabled: false
  # CodeReady Workspaces
  - name: crw
    enabled: true
    destination: crw
    source: https://github.com/rht-labs/refactored-adventure
    source_path: crw/base
    source_ref: master
    sync_policy: *sync_policy_no_selfheal
    no_helm: true
    ignore_differences:
      - group: org.eclipse.che
        kind: CheCluster
        jsonPointers:
          - /spec
  # Zalenium
  - name: zalenium
    enabled: false
    source: https://github.com/zalando/zalenium.git
    source_path: charts/zalenium
    source_ref: "master"
    sync_policy: *sync_policy_true
    destination: *ci_cd_ns
    values:
      hub:
        serviceType: ClusterIP
        openshift:
          deploymentConfig:
            enabled: true
          route:
            enabled: true
        persistence:
          enabled: false
        serviceAccount:
          create: false
        desiredContainers: 0
        podAnnotations:
          app: zalenium
  # Hoverfly
  - name: hoverfly
    enabled: false
    source: https://github.com/helm/charts.git
    source_path: incubator/hoverfly
    sync_policy: *sync_policy_true
    destination: *ci_cd_ns
    source_ref: "master"
    values:
      replicaCount: "1"
      openshift:
        route:
          admin:
            enabled: true
            hostname: ""
          proxy:
            enabled: true
            hostname: ""
    ignore_differences:
      - group: route.openshift.io
        kind: Route
        jsonPointers:
          - /status/ingress
          - /spec/host
      - group: apps/v1
        kind: Deployment
        jsonPointers:
          - /spec/replicas
  # Tekton
  - name: tekton
    enabled: true
    destination: openshift-operators
    source: https://github.com/rht-labs/refactored-adventure
    source_path: tekton/base
    source_ref: master
    sync_policy: *sync_policy_true
    no_helm: true
  # CertUtils
  - name: cert-utils
    enabled: false
    destination: openshift-operators
    source: https://github.com/rht-labs/refactored-adventure
    source_path: cert-utils/base
    source_ref: master
    sync_policy: *sync_policy_true
    no_helm: true
  # Knative
  - name: knative
    enabled: false
    destination: openshift-serverless
    source: https://github.com/rht-labs/refactored-adventure
    source_path: knative/serving
    source_ref: master
    sync_policy: *sync_policy_true
    no_helm: true
  # Bootstrap Journey
  - name: bootstrap-journey
    enabled: true
    source: https://github.com/petbattle/ubiquitous-journey.git
    source_path: bootstrap
    destination: labs-bootstrap
    source_ref: "main"
    sync_policy: *sync_policy_true
    values:
      argocd-operator:
        ignoreHelmHooks: true
    helm_values:
      - values-bootstrap.yaml
  # Pet Battle Tekton objects
  - name: tekton-pipelines
    destination: labs-ci-cd
    enabled: true
    source: https://github.com/petbattle/ubiquitous-journey.git
    source_path: tekton
    source_ref: main
    sync_policy: *sync_policy_true
    no_helm: true
  # Matamo
  - name: matomo
    enabled: false
    source: https://github.com/petbattle/pet-battle-analytics.git
    source_path: charts/matomo
    sync_policy: *sync_policy_true
    destination: labs-ci-cd
    source_ref: main
    ignore_differences:
    - group: apps
      kind: Deployment
      jsonPointers:
        - /spec/replicas
        - /spec/template/spec/containers/0/image
        - /spec/template/spec/containers/1/image
   # Istio basic mesh
  - name: istio
    enabled: false
    destination: openshift-operators
    source: https://github.com/rht-labs/refactored-adventure
    source_path: istio/istio-system
    source_ref: master
    sync_policy: *sync_policy_true
    no_helm: true
  # Allure
  - name: allure
    enabled: false
    source: https://github.com/eformat/allure
    source_path: "chart"
    source_ref: "main"
    sync_policy: *sync_policy_true
    destination: *ci_cd_ns
    ignore_differences:
      - group: apps
        kind: Deployment
        jsonPointers:
          - /spec/template/spec/containers/0/image
